# Настройка Netlify + Neon Database

## Автоматическая настройка через Netlify Extensions

### 1. Установка расширения Neon
1. Откройте панель Netlify → Ваш проект → **Extensions**
2. Найдите **Neon Database** в каталоге расширений
3. Нажмите **Install** для подключения к Neon
4. Следуйте инструкциям для создания/подключения базы данных

### 2. Автоматическая конфигурация
После установки расширения:
- Netlify автоматически создаст переменную `NETLIFY_DATABASE_URL`
- База данных Neon будет подключена к проекту
- При деплое будет доступна автоматическая инициализация

### 3. Проверка настройки
Проверьте статус базы данных через:
- **Health Check**: `https://your-site.netlify.app/.netlify/functions/health-check`
- **Admin Panel**: Settings → База данных → Открыть панель управления БД
- **Auto Init**: `https://your-site.netlify.app/.netlify/functions/auto-init`

## Полезные команды

```bash
# Локальная проверка (для разработки)
npm run db:health     # Проверка состояния БД
npm run db:init       # Инициализация схемы
npm run db:seed       # Добавление тестовых данных
npm run db:auto-init  # Полная автоматическая настройка
```

## URL endpoints после деплоя

- **Проверка здоровья**: `/admin/health`
- **Инициализация БД**: `/admin/init-db` 
- **Добавление данных**: `/admin/seed-data`
- **API**: `/api/*` (прокси к /.netlify/functions/api)

## Автоматизация инициализации

Создана функция `auto-init`, которая:
1. Проверяет наличие `NETLIFY_DATABASE_URL`
2. Автоматически инициализирует схему при первом деплое
3. Добавляет стандартные категории
4. Предоставляет детальную диагностику

Вызов после деплоя:
```bash
curl -X POST https://your-site.netlify.app/.netlify/functions/auto-init
```

## Мониторинг и диагностика

В приложении доступна панель администратора БД:
1. **Settings** → **База данных** → **Открыть панель управления БД**
2. Показывает: состояние подключения, версию PostgreSQL, размер БД
3. Статистику по таблицам и записям
4. Рекомендации по устранению неполадок

## Переменные окружения

### Production (автоматически от Netlify + Neon)
- `NETLIFY_DATABASE_URL` - строка подключения к Neon PostgreSQL
- `URL` / `DEPLOY_URL` - URL развернутого сайта
- `CONTEXT` - контекст деплоя (production/deploy-preview)

### Development
Для локальной разработки создайте `.env.local`:
```
NETLIFY_DATABASE_URL=postgresql://username:password@host/database
```

## Архитектурные преимущества

1. **Нулевая конфигурация**: Netlify + Neon интеграция работает из коробки
2. **Автоматическое масштабирование**: Neon автоматически управляет ресурсами БД
3. **Serverless архитектура**: PostgreSQL просыпается только при запросах
4. **Встроенный мониторинг**: Детальная диагностика через admin панель
